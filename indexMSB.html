<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Màn Hình Hiển Thị 10x13</title>
    <style>
        body { background: #000; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        
        .grid-container {
            display: grid;
            grid-template-columns: repeat(13, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 5px;
            width: 98vw;
            height: 95vh;
        }

        .cell {
            background: #111;
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid #222;
            transition: all 0.6s ease;
        }

        .cell img {
            width: 100%; height: 100%; object-fit: cover;
            filter: grayscale(100%) brightness(0.1); /* Mặc định tối đen */
            transition: 0.8s;
        }

        /* Hiệu ứng khi được check-in */
        .cell.active {
            border: 2px solid #00f2ff;
            box-shadow: 0 0 15px #00f2ff;
            transform: scale(1.02);
        }

        .cell.active img {
            filter: grayscale(0%) brightness(1);
        }
    </style>
</head>
<body>

    <div id="grid" class="grid-container"></div>

    <script type="module">
	    import { doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, query, orderBy, onSnapshot } 

        from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAdmwwhCZh3MS7vM03MiL_FTIluqQNmFxo",
            authDomain: "checkin-69311.firebaseapp.com",
            projectId: "checkin-69311",
            storageBucket: "checkin-69311.firebasestorage.app",
            messagingSenderId: "682738949510",
            appId: "1:682738949510:web:760eb6c7d591af6fb16007"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
		
		async function initData() {
            for (let i = 1; i <= 130; i++) {
                const userRef = doc(db, "user", `user_${i}`);
                try {
                    await setDoc(userRef, {
                        id: i,
                        user_name: `User ${i}`,
                        url_images: `https://picsum.photos/id/${i}/200/200`,
                        is_active: false,
                        create_at: serverTimestamp()
                    });
                    console.log(`Đã tạo: user_${i}`);
                } catch (e) {
                    console.error("Lỗi: ", e);
                }
            }
            alert("Hoàn tất khởi tạo 130 User!");
        }
		//initData();

        // Lấy collection "user" (đúng theo tên trong ảnh bạn chụp)
        const q = query(collection(db, "user"), orderBy("id", "asc"));

        onSnapshot(q, (snapshot) => {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            snapshot.forEach((doc) => {
                const data = doc.data();
                const cell = document.createElement('div');
                
                // Kiểm tra trạng thái is_active để sáng đèn
                cell.className = `cell ${data.is_active ? 'active' : ''}`;
                
                const img = document.createElement('img');
                // Khớp với trường url_images trong ảnh của bạn
                img.src = data.url_images || 'https://via.placeholder.com/150'; 
                
                cell.appendChild(img);
                grid.appendChild(cell);
            });
        });
    </script>
</body>
</html>